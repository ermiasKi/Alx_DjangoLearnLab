{% extends 'base.html' %}

{% block title %}Edit Comment - Django Blog{% endblock %}

{% block content %}
<div class="update-comment-container" style="max-width: 700px; margin: 0 auto;">
    <!-- Header Section -->
    <div class="update-header" style="background: white; padding: 30px; border-radius: 8px 8px 0 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
            <div style="width: 50px; height: 50px; background: #ffc107; color: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                ‚úèÔ∏è
            </div>
            <div>
                <h1 style="margin: 0; color: #333;">Edit Your Comment</h1>
                <p style="margin: 5px 0 0 0; color: #666;">
                    Updating comment on: <strong>"{{ object.post.title }}"</strong>
                </p>
            </div>
        </div>
        
        <!-- Comment Context -->
        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>Original Comment Details:</strong>
                    <div style="color: #666; font-size: 14px; margin-top: 5px;">
                        Created: {{ object.created_at|date:"M d, Y g:i A" }}
                        {% if object.updated_at != object.created_at %}
                        ‚Ä¢ Last edited: {{ object.updated_at|date:"M d, Y g:i A" }}
                        {% endif %}
                    </div>
                </div>
                <a href="{% url 'post-detail' object.post.pk %}" class="btn" style="display: inline-flex; align-items: center; gap: 5px; padding: 8px 16px;">
                    üëÅÔ∏è View Post
                </a>
            </div>
        </div>
    </div>

    <!-- Edit Form -->
    <div class="edit-form-container" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <form method="post">
            {% csrf_token %}
            
            <!-- Form Errors -->
            {% if form.non_field_errors %}
            <div class="form-errors" style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; border-left: 4px solid #dc3545; margin-bottom: 20px;">
                <strong>Please correct the following errors:</strong>
                <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                    {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Content Field -->
            <div class="form-group" style="margin-bottom: 25px;">
                <label for="{{ form.content.id_for_label }}" style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">
                    Your Comment:
                </label>
                
                <textarea 
                    name="content" 
                    id="content" 
                    class="form-control" 
                    rows="8" 
                    placeholder="Share your thoughts..."
                    style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; line-height: 1.6; resize: vertical; transition: border-color 0.3s ease;"
                    onfocus="this.style.borderColor='#007bff';"
                    onblur="this.style.borderColor='#e9ecef';"
                >{{ form.content.value|default:'' }}</textarea>
                
                <!-- Field Errors -->
                {% if form.content.errors %}
                <div class="field-errors" style="color: #dc3545; font-size: 14px; margin-top: 8px;">
                    {% for error in form.content.errors %}
                    <div style="display: flex; align-items: center; gap: 5px; margin-bottom: 5px;">
                        <span>‚ö†Ô∏è</span>
                        <span>{{ error }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Help Text -->
                <div class="help-text" style="color: #666; font-size: 14px; margin-top: 8px;">
                    <div>üí° <strong>Tips:</strong> Be respectful and constructive in your comments.</div>
                    <div>üìù You can use basic formatting with line breaks.</div>
                </div>
            </div>

            <!-- Character Counter (Optional) -->
            <div class="character-counter" style="text-align: right; color: #666; font-size: 14px; margin-bottom: 20px;">
                Characters: <span id="charCount">0</span>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions" style="display: flex; justify-content: space-between; align-items: center; padding-top: 20px; border-top: 1px solid #e9ecef;">
                
                <div class="submit-section">
                    <button type="submit" class="btn" style="background-color: #28a745; display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 16px;">
                        üíæ Update Comment
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Preview Section -->
    <div class="preview-section" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px;">
        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center; gap: 10px;">
            üëÅÔ∏è Live Preview
        </h3>
        <div id="commentPreview" style="background: #f8f9fa; padding: 20px; border-radius: 5px; border-left: 4px solid #17a2b8; min-height: 100px; line-height: 1.6;">
            <em style="color: #666;">Your comment preview will appear here...</em>
        </div>
        <div style="color: #666; font-size: 14px; margin-top: 10px;">
            This is how your comment will look to other users.
        </div>
    </div>

    <!-- Edit Guidelines -->
    <div class="edit-guidelines" style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #007bff;">
        <h4 style="margin: 0 0 10px 0; color: #0056b3; display: flex; align-items: center; gap: 8px;">
            üìã Comment Guidelines
        </h4>
        <ul style="margin: 0; padding-left: 20px; color: #0056b3;">
            <li>Keep comments respectful and constructive</li>
            <li>Stay on topic with the post content</li>
            <li>Avoid personal attacks or offensive language</li>
            <li>Use proper formatting for readability</li>
        </ul>
    </div>
</div>

<!-- JavaScript for Enhanced Features -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentTextarea = document.getElementById('content');
    const charCount = document.getElementById('charCount');
    const preview = document.getElementById('commentPreview');
    
    // Character counter
    function updateCharCount() {
        const length = contentTextarea.value.length;
        charCount.textContent = length;
        
        // Color coding for character count
        if (length > 1000) {
            charCount.style.color = '#dc3545';
        } else if (length > 500) {
            charCount.style.color = '#ffc107';
        } else {
            charCount.style.color = '#28a745';
        }
    }
    
    // Live preview
    function updatePreview() {
        const content = contentTextarea.value;
        if (content.trim() === '') {
            preview.innerHTML = '<em style="color: #666;">Your comment preview will appear here...</em>';
        } else {
            // Convert line breaks to <br> tags for preview
            const formattedContent = content.replace(/\n/g, '<br>');
            preview.innerHTML = formattedContent;
        }
    }
    
    // Event listeners
    contentTextarea.addEventListener('input', function() {
        updateCharCount();
        updatePreview();
    });
    
    // Initialize on page load
    updateCharCount();
    updatePreview();
    
    // Auto-focus on content field
    contentTextarea.focus();
    contentTextarea.setSelectionRange(contentTextarea.value.length, contentTextarea.value.length);
});
</script>

<style>
.update-comment-container {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.btn {
    display: inline-flex;
    align-items: center;
    background-color: #333;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
    text-decoration: none;
}

.btn:hover {
    background-color: #555;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    text-decoration: none;
    color: white;
}

.form-control:focus {
    outline: none;
    border-color: #007bff !important;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

/* Responsive Design */
@media (max-width: 768px) {
    .update-comment-container {
        padding: 10px;
    }
    
    .form-actions {
        flex-direction: column;
        gap: 15px;
    }
    
    .cancel-section,
    .submit-section {
        width: 100%;
        text-align: center;
    }
    
    .cancel-section .btn,
    .submit-section .btn {
        width: 100%;
        margin: 5px 0;
        justify-content: center;
    }
}

/* Animation for preview */
#commentPreview {
    transition: all 0.3s ease;
}

/* Loading state for submit button */
.btn.loading {
    position: relative;
    color: transparent;
}

.btn.loading::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    top: 50%;
    left: 50%;
    margin-left: -10px;
    margin-top: -10px;
    border: 2px solid #ffffff;
    border-radius: 50%;
    border-right-color: transparent;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
</style>
{% endblock %}